<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>深入浅出 JavaScript 函数</title>
  <link rel="stylesheet" href="./css/base.css">
  <link rel="stylesheet" href="./css/app.css">
  <link rel="stylesheet" href="./css/fullscreen.css">
  <link rel="stylesheet" href="./css/scrollbar.css">
  <link rel="stylesheet" href="./css/animation.function.css">
</head>
<body spellcheck="false">
  <section class="helper">
    <h1>文档说明</h1>
    <ul>
      <li>alt+p 切换文档显示模式(文档模式和ppt模式)</li>
      <li>alt+enter 全屏显示 - ppt模式</li>
      <li>在 ppt 显示模式下, ctrl + r 让ppt轮循显示</li>
      <li>上/下/左/右/PageUp/PageDown键切换ppt</li>
      <li>Home/End 切换到文档开头/结尾</li>
      <li>ctrl+g 手动指定到页数</li>
      <li>联系 QQ: 295143921</li>
    </ul>
  </section>
  <section class="slide slide-cover">
    <h1>深入浅出 JavaScript 函数</h1>
    <h2 class="h6">REDKY@qq.com</h2>
  </section>
  <section class="slide">
    <h1>函数基础</h1>
    <ol>
      <li>函数定义</li>
      <li>函数参数和返回值</li>
      <li>函数调用</li>
      <li>匿名函数</li>
      <li>变量作用域 - 闭包</li>
      <li>其它 - 递归, 链式调用等</li>
    </ol>
  </section>
  <section class="slide">
    <h1>函数定义</h1>
    <dl>
      <dt>函数声明</dt>
      <dd><code>function getUserName( user ) {}</code></dd>
      <dt>函数表达式</dt>
      <dd><code>var getUserName = function( user ) {};</code></dd>
      <dt>基于构造函数</dt>
      <dd><code>var getUserName = new Function( 'user', 'return user.name;' );</code></dd>
    </dl>
  </section>
  <section class="slide">
    <h1>函数参数和返回值</h1>
    <h2 class="h4">参数</h2>
    <ul>
      <li>定义时, 参数可不写; 调用时, 使用 arguments 访问</li>
      <li>形参[形式参数]: 参数个数 <code>getUserName.length</code></li>
      <li>实参[实际调用时参数]: 参数个数 <code>arguments.length</code></li>
      <li>调用时参数可为任意数据类型(包含 function)</li>
    </ul>
    <mark>参数传递值和引用</mark>
  </section>
  <section class="slide">
    <h1>实例</h1>
    <div class="codebox">
<pre contenteditable="true">
function getUserName( user, boolean ) {
  alert( 'arguments.length: ' + arguments.length );
  user.name = 'browser';
  boolean = false;
}
alert( 'getUserName.length: ' + getUserName.length );
var user = {name: 'sogo' }, boolean = true;;
getUserName( user, boolean, function() {} );
alert( 'user: ' + JSON.stringify(user) );
alert( 'boolean: ' + boolean );

</pre>
      <div class="runcase">Run</div>
    </div>
  </section>
  <section class="slide">
    <h1>函数参数和返回值</h1>
    <h2 class="h4">返回值</h2>
    <p>任意数据类型</p>
  </section>
  <section class="slide">
    <h1>函数调用</h1>
    <dl>
      <dt>直接调用 - 最常用</dt>
      <dd><code>getUserName( user );</code></dd>
      <dt>方法调用</dt>
      <dd><code>extension.getUserName( user );</code></dd>
      <dt>使用 call/apply</dt>
      <dd><code>getUserName.call( extension, user );</code> </dd>
      <dd><code>getUserName.apply( extensioin, [user] );</code></dd>
      <dt>使用 new 关键字 - 函数称为构造函数, 用于实例化对象</dt>
      <dd><code>new System();</code></dd>
    </dl>
  </section>
  <section class="slide">
    <h1>匿名函数</h1>
    <ul>
      <li><code>;(function() {})(); // 自执行</code></li>
      <li><code>var getUserName = function/*getUserName*/() {};</code></li>
      <li><code>element.addEventListener('click', function() {}, false );</code></li>
      <li><code>requestAnimationFrame(function() {}, 100); // setInterval</code></li>
      <li><code>promise().done(function() {}).fail(function() {}); // jQuery</code></li>
      <li><code>'?path=p1'.replace(/[^?&]path=[^#&]*/i,function() {});</code></li>
      <li><code>[1,3,2].sort(function( a, b ) { return a - b;});</code></li>
      <li><code>function func(){return function() {};}</code></li>
    </ul>
  </section>
  <section class="slide">
    <h1>变量作用域 - 闭包</h1>
    <p><strong>函数创建作用域</strong>, 作用域包裹变量.</p>
    <p><a href="https://github.com/zhanhongtao/blog/issues/6" target="_blank">讨论此话题</a></p>
  <div class="codebox">
<pre contenteditable="true">
function createCount(){
  var count = 1;
  return function() {
    return ++count;
  };
}
var count = createCount();
count(); count(); // 3
alert( count() ); // 4;
</pre>
  <div class="runcase">Run</div>
  </div>
  </section>
  <section class="slide">
    <h1>实例</h1>
    <div class="codebox">
<pre contenteditable="true">
// 设置字体值. 要求: 最大值为 200, 最小值为 100
var MIN_FONT_SIZE = 100;
var MAX_FONT_SIZE = 200;
function setFontSize( value ) {
  value = Math.max.call( Math, MIN_FONT_SIZE, value );
  value = Math.min.call( Math, MAX_FONT_SIZE, value );
  alert( value );
}
setFontSize( 120 );
setFontSize( 50 );
setFontSize( 240 );
</pre>
  <div class="runcase">Run</div>
  </div>
  </section>
  <section class="slide">
    <h1>实例</h1>
    <div class="codebox">
<pre contenteditable="true">
// 求数据类型.
function type( s ) {
  var classtype = Object.prototype.toString.call( s );
  return classtype.slice(8, -1).toLowerCase();
}
alert( [ type(1), type('')] );
alert( [ type(void(0)), type(null), type([]), type({}) ] );
alert( [ type(new Date), type(/h/g) ] );
</pre>
    <div class="runcase">Run</div>
    </div>
  </section>
  <section class="slide">
    <h1>实例</h1>
<pre>
/**
  指定运行时 this.
  Function.prototype.bind
  * 修正 ie 早期版本 this 指向.
  * 函数作为回调时, 保证 this 指向.
*/
function bind( func, context ) {
  return function() {
    return func.apply( context || this, arguments );
  };
}
</pre>
  </section>
  <section class="slide">
    <h1>实例</h1>
<a href="./demo/bind-ie.html" target="_blank">实例(only ie)</a>
<pre contenteditable="true">
if ( document.attachEvent ) {
  document.attachEvent( 'onclick', function() {
    alert( this );
  });
  document.attachEvent( 'onclick', bind(function() {
    alert( this );
  }, document);
}
</pre>
  </section>
  <section class="slide">
    <h1>实例</h1>
    <div class="codebox">
<pre contenteditable="true">
var system = {
  name: 'sogou',
  runcase: function() {
    return !!this.name && this.name.indexOf( 'o' ) > -1;
  }
};
function getBrowserDataFromServer( cb ) {
  var data = { name: 'chrome' };
  return bind( cb, data )();
}
alert( getBrowserDataFromServer( system.runcase ) );
</pre>
      <div class="runcase">Run</div>
    </div>
  </section>
  <section class="slide">
    <h1>实例 - 匿名函数</h1>
<div class="codebox sub-slide">
<pre id="anonymous-function-1" contenteditable="true">
var element = document.getElementById( 'anonymous-function-1' );
var onClick = function() { alert('onClick'); };
element.addEventListener( 'click', onClick, false );
element.addEventListener( 'click', onClick, false );
</pre>
  <div class="runcase">Run</div>
</div>
<div class="codebox sub-slide">
<pre id="anonymous-function-2" contenteditable="true">
var element = document.getElementById( 'anonymous-function-2' );
element.addEventListener( 'click', function() {
  alert('click');
}, false );
element.addEventListener( 'click', function() {
  alert('click');
}, false );
</pre>
  <div class="runcase">Run</div>
</div>
  </section>
  <section class="slide">
    <h1>其它</h1>
    <ul>
      <li>只读 name 属性 - 返回函数名; 匿名函数返回空字符串</li>
      <li>arguments.callee 指向当前函数. 严格模式不再支持</li>
    </ul>
    <div class="codebox">
<pre contenteditable="true">
// 'use strict'
function getName( user ) {
  try {
    alert( arguments.callee.name );
  } catch(e) {
    alert( 'error' );
  }
}
getName();
</pre>
      <div class="runcase">Run</div>
    </div>
  </section>
  <section class="slide">
    <h1>其它 - 递归</h1>
    <div data-run="1" class="codebox">
<pre contenteditable="true">
function flatArray( array ) {
  var i = 0, l = array.length, result = [], current;
  for ( ; i < l; i++ ) {
    current = array[i];
    // concat 支持单层合并.
    result = result.concat(type(current) ==='array' ?
        flatArray(current) : current );
  }
  return result;
}
alert( flatArray( [1,2,[3],[4,[5],6],7] ) );
</pre>
  <div class="runcase">Run</div>
  </div>
  </section>
  <section class="slide">
    <h1>其它 - 链式调用</h1>
      <div class="codebox">
<pre contenteditable="true">
// 原理: 函数返回值存在方法
[1, 2].map(function( item ) {
  return item * 2;
}) // return array.
.forEach(function( item ) {
  alert( item );
});
</pre>
        <div class="runcase">Run</div>
      </div>
  </section>
  <section class="slide">
    <h1>其它 - 链式调用</h1>
    <div class="codebox">
<pre contenteditable="true">
var _ = function( value ) {
  if ( value instanceof _ ) return value;
  if ( !(this instanceof _) ) return new _(value);
  this.core = value;
};
_.prototype.max = function() {
  return Math.max.apply( Math, this.core );
};
_.chain = function( value ) {
  return new _( value );
};
var max = _( [1, 2, 5, 3 ] ).max();
// var max = _.chain( [1, 2, 5, 3] ).max();
alert( max );
</pre>
    <div class="runcase">Run</div>
  </section>
  <section class="slide">
    <h1>其它</h1>
    <ul>
      <li>函数调试 - console.trace</li>
      <li>单元测试</li>
    </ul>
  </section>
  <section class="slide slide-cover">
    <h1>function !important</h1>
  </section>
  <section class="slide">
    <h1>函数转换</h1>
    <ul>
      <li>partial</li>
      <li>once</li>
      <li>wrap</li>
      <li>debounce/throttle</li>
      <li>create</li>
      <li>after</li>
      <li>queue/sync/syncEX</li>
    </ul>
  </section>
  <section class="slide">
    <h1>partial</h1>
    <p>不完全函数 - <a href="http://benalman.com/news/2012/09/partial-application-in-javascript/" target="_blank">更多</a></p>
    <div class="codebox">
<pre contenteditable="true">
function partial( func ) {
  var argus = [].slice.call( arguments, 1 );
  return function() {
    return func.apply( this, argus.concat([].slice.call(arguments)) );
  };
}
var add = partial(function( a, b ) {
  return a + b;
}, 5);
alert( add(3) ); // 8
</pre>
      <div class="runcase">Run</div>
    </div>
  </section>
  <section class="slide">
    <h1>once</h1>
    <div class="codebox">
<pre contenteditable="true">
function once( func ) {
  var flag, result;
  return function() {
    if ( flag ) return result;
    flag = true;
    result = func.apply( this, arguments );
    return result;
  };
}
var times = once(function() {alert( 1 );});
times();times();
</pre>
      <div class="runcase">Run</div>
    </div>
  </section>
  <section class="slide">
    <h1>once</h1>
    <p>用途: 防止重复绑定事件 - jQuery</p>
<pre>
var bindEvents = once(function() {
  $( element ).on( 'click', function() {
    //...
  });
});
</pre>
  </section>
  <section class="slide">
    <h1>wrap</h1>
<pre contenteditable="true">
function wrap( self, func ) {
  return function() {
    var _arguments = arguments;
    var next = function() {
      var argus = arguments.length ? arguments : _arguments;
      return self.apply( null, argus );
    };
    var argus = [].slice.call( arguments );
    var length = func.length;
    argus = length < 2 ? [] : argus.slice( 0, length - 1);
    argus.push( next );
    return func.apply( null, argus );
  };
}
</pre>
  </section>
  <section class="slide">
    <h1>wrap - 面向切面</h1>
    <div class="codebox">
<pre contenteditable="true">
function sendRequest( method ) {
  alert( 'request: ' + method );
  return 1;
}
sendRequest = wrap( sendRequest, function( next ) {
  alert( 'before request' );
  var result = next( 'POST' );
  alert( 'after request' );
  return result;
});
sendRequest(); // 1;
</pre>
    <div class="runcase">Run</div>
    </div>
  </section>
  <section class="slide">
    <h1>wrap - 扩展方法</h1>
    <div class="codebox">
<pre contenteditable="true">
function $( selector ) {
  return document.querySelectorAll( selector );
}
$ = wrap( $, function(selector, next) {
  var core = next();
  return {
    each: function( func ) {
      for( var i = 0, l = core.length; i < l; i++ )
        func( core[i], i );
      return this;
    }
  };
});
$('.slide-cover').each(function(slide) {
  alert(slide.innerHTML);
});
</pre>
    <div class="runcase">Run</div>
    </div>
  </section>
  <section class="slide">
    <h1>wrap - 模拟once</h1>
    <div class="codebox">
<pre contenteditable="true">
var a = function() {
  alert(1);
};

a = wrap( a, function a( next ) {
  if ( a.tag ) return a.cache;
  a.tag = true;
  return a.cache = next();
});

a();
a();
</pre>
    <div class="runcase">Run</div>
    </div>
  </section>
  <section class="slide">
    <h1>实用场景</h1>
    <ul>
      <li>频繁点击按钮, 提交表单</li>
      <li>blur和submit 重复提交操作</li>
      <li>频繁按 ctrl + s 快捷键</li>
      <li>resize 频繁重新渲染 DOM</li>
      <li>mousemove/scroll 频繁触发</li>
      <li>网页中搜索建议, 发送的请求如何处理?</li>
    </ul>
  </section>
  <section class="slide">
    <h1>懒惰型函数</h1>
    <p>短时间内(100ms)多次发生相同事件, 但仅需要执行最后一次.</p>
<pre contenteditable="true">
function debounce( func, wait ) {
  var old = new Date;
  var timer;
  function ret() {
    if ( timer ) { clearTimeout( timer ); timer = null;}
    var argus = arguments;
    timer = setTimeout(function() {
      timer = null;
      func.apply( null, argus );
    }, wait);
  };
  return ret;
}
</pre>
  </section>
  <section class="slide">
    <h1>节制性函数</h1>
    <p>短时间内(100ms)发生n次相同事件, 而仅需执行m(m<=n)次.</p>
<pre contenteditable="true;">
function throttle( func, wait ) {
  var timer;
  var previous = 0;
  var args;
  var context;
  var later = function() {
    previous = new Date;
    func.apply( context, args );
  };
  return function() {
    var now = new Date;
    if ( previous === 0 ) previous = new Date;
    args = arguments;
    context = this;
    var remaining = wait - ( now - previous );
    if ( remaining <= 0 ) {
      func.apply( this, arguments );
      timer = null;
      previous = now;
    }
    else if ( !timer ) {
      timer = setTimeout( later, remaining );
    }
  };
}
</pre>
  </section>
  <section class="slide">
    <h1>实用场景</h1>
    <ul>
      <li>window7/8 Area 效果</li>
      <li>sogou图片搜索, 图片放大效果. (<a href="http://pic.sogou.com/pics?query=sogou&p=&dp=&di=2&_asf=pic.sogou.com&_ast=1379479771&w=05009900" target="_blank">实例</a>)</li>
      <li>hover 切换标签(<a href="http://tv.sohu.com/" target="_blank" title="电视局排行榜">实例</a>)</li>
    </ul>
  </section>
  <section class="slide">
    <h1>create</h1>
    <div class="codebox">
<pre contenteditable="true" id="demo-create">
var element = document.querySelector( '.demo-case-fixed' );
var slide = document.querySelector( '#demo-create' );
var f = create( function() {
  element.style.display = 'block';
}, true, 0);
var onMouseOver = (function() {
  var timer;
  return function () {
    if ( timer ) {
      clearTimeout( timer );
    }
    f.on();
    timer = setTimeout( f.done, 200 );
  };
})();
var onMouseOut = function() {
  f.off(function() {
    element.style.display = 'none';
  });
};
slide.addEventListener( 'mouseover', onMouseOver, false );
slide.addEventListener( 'mouseout', onMouseOut, false );
</pre>
      <div class="runcase">Run</div>
      <div class="demo-case-fixed"></div>
      <style>
        .demo-case-fixed {
          display: none;
          position: absolute;
          top: 0;
          left: 0;
          width: 50px;
          height: 50px;
          background-color: red;
        }
      </style>
    </div>
  </section>
  <section class="slide">
    <h1>实用场景</h1>
    <ul>
      <li>需求: 按键盘 sogou 字符, 出现惊喜.</li>
    </ul>
  </section>
  <section class="slide">
    <h1>after</h1>
    <div class="codebox">
<pre contenteditable="true">
  ;(function() {
    var func = (function() {
      var space = [];
      var keycodes = [ 83, 79, 71, 79, 85 ];
      var ok5;
      var timer;
      function check() {
        if ( keycodes.join() === space.join() ) {
          alert( '\u60CA\u559C' );
        }
      }
      function init() {
        space.length = 0;
        ok5 = after( keycodes.length, function() {
          check();
          init();
        });
      }
      function later() {
        init();
        timer = null;
      }
      init();
      return function( keycode ) {
        if ( !timer ) {
          timer = setTimeout( later, 1000 );
        }
        if ( keycodes.indexOf(keycode) === -1 ) {
          init();
          return;
        }
        space[ space.length ] = keycode;
        ok5();
      };
    })();

    document.onkeydown = function( event ) {
      event = event || window.event;
      func( event.keyCode );
    };
  })();
</pre>
      <div class="runcase">Run</div>
    </div>
  </section>
  <section class="slide">
    <h1>after</h1>
<div class="codebox">
<pre contenteditable="true">
var array = [ 1, 2 ];
var func = (function() {
  var argus = [];
  var func = after( array.length, function( a, b ) {
    alert( ['result', a, b ].join('-') );
    argus.length = 0;
  });
  return function( value ) {
    argus.push( value );
    func.apply( this, argus );
  };
})();
array.forEach(function( item, index ) {
  setTimeout(function() {
    func( item );
  }, (index+1) * 1000 );
});
</pre>
<div class="runcase">Run</div>
</div>
  </section>
  <section class="slide">
    <h1>实用场景</h1>
    <ul>
      <li>元素a, 从位置[0,0] 先移到[0, 100], 再到[100, 100] <a href="../html/queue.html" target="_blank">实例</a></li>
      <li>需求: 对 n 个服务接口, 做单元测试.</li>
      <li>nodejs 中多表依赖查询</li>
    </ul>
  </section>
  <section class="slide">
    <h1>queue</h1>
<div class="codebox">
<pre contenteditable="true">
console.time( 'queue' );
queue( [1, 2], function( item, index, ret, next ) {
  setTimeout(function() {
    next( item );
  }, (index+1) * 1000 );
}, function( a, b ) {
  console.timeEnd( 'queue' );
  alert( [ 'result', a, b ].join('-') );
});
</pre>
<div class="runcase">Run</div>
</div>
  </section>
  <section class="slide">
    <h1>实用场景</h1>
    <ul>
      <li>同时请求模板和数据, 成功后渲染页面</li>
      <li><a href="../html/sync.html" target="_blank">动画实例</a></li>
    </ul>
  </section>
  <section class="slide">
    <h1>sync</h1>
<div class="codebox">
<pre contenteditable="true">
console.time( 'sync' );
sync( [1, 2], function( item, index, ret, done ) {
  setTimeout( function() {
    done( item );
  }, (index+1) * 1000 );
}, function( a, b ) {
  console.timeEnd( 'sync' );
  alert( [ 'result', a, b ].join('-') );
});
</pre>
<div class="runcase">Run</div>
</div>
  </section>
  <section class="slide">
    <h1>syncEX</h1>
<div class="codebox">
<pre contenteditable="true">
syncEX( [1, 2, 3, 4, 5], function( item, done ) {
  setTimeout(function() {
    done( item );
  }, Math.random() * 1000 );
}, function( a, b ) {
  var argus = [].slice.call( arguments );
  alert( argus );
}, true);
</pre>
<div class="runcase">Run</div>
</div>
  </section>
  <section class="slide">
    <h1>参考</h1>
    <ul>
      <li>权威指南 6</li>
      <li><a href="http://sketch.evanyou.me/async_asap.html" target="_blank">前端异步 api 调用</a></li>
      <li><a href="http://www.zhihu.com/question/19805411" target="_blank">如何防止重复提交?</a></li>
      <li><a href="http://lodash.com/" target="_blank">lodash</a> & <a href="https://github.com/jashkenas/underscore/blob/master/underscore.js" target="_blank">underscore.js</a></li>
      <li><a href="http://caolanmcmahon.com/posts/flexible_callback_arguments/" target="_blank">flexible callback arguments</a></li>
      <li><a href="http://osteele.com/sources/javascript/functional/" target="_blank">functional</a></li>
    </ul>
  </section>
  <section class="slide slide-cover">
    <h1>?</h1>
  </section>
  <nav id="navigator"></nav>
  <script src="./js/event.js"></script>
  <script src="./js/functional.js"></script>
  <script src="./js/hash.js"></script>
  <script src="./js/runcase.js"></script>
  <script src="./js/resize.js"></script>
  <script src="./js/pattern.js"></script>
  <script src="./js/ui.js"></script>
  <script src="./js/app.js"></script>
</body>
</html>