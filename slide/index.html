<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>深入浅出 JavaScript 函数</title>
  <link rel="stylesheet" href="./css/default.css">
  <link rel="stylesheet" href="./css/base.css?v=2">
  <link rel="stylesheet" href="./css/app.css?v=2">
  <link rel="stylesheet" href="./css/fullscreen.css">
  <link rel="stylesheet" href="./css/scrollbar.css">
  <link rel="stylesheet" href="./css/animation.function.css">
  <script src="./js/highlight.pack.js"></script>
  <script type="text/javascript">
  hljs.tabReplace = '    ';
  hljs.initHighlightingOnLoad();
  </script>
</head>
<body spellcheck="false">
  <section class="pc-helper content-toggle">
    <h1>文档说明</h1>
    <ul>
      <li>alt+p 切换显示模式</li>
      <!--<li>alt+enter 全屏显示 - ppt模式</li>-->
      <li>在 ppt 显示模式下, ctrl + r 让ppt轮循显示</li>
      <li>上/下/左/右/PageUp/PageDown键切换ppt</li>
      <li>Home/End 切换到文档开头/结尾</li>
      <li>ctrl+g 手动指定到页数</li>
    </ul>
  </section>
  <section class="slide slide-cover">
    <h1>深入浅出 JavaScript 函数</h1>
    <h2 class="h6">REDKY@qq.com</h2>
  </section>
  <section class="content-toggle">
    <h1>自我介绍</h1>
    <ul>
      <li>占红涛</li>
      <li>QQ: 295143921</li>
      <li>github: <a href="http://github.com/zhanhongtao/" target="_blank">@zhanhongtao</a></li>
      <li>weibo: <a href="http://1.t.qq.com/redead" target="_blank">@redead</a></li>
    </ul>
  </section>
  <section class="slide">
    <h1>函数基础</h1>
    <ul>
      <li>函数定义</li>
      <li>函数参数和返回值</li>
      <li>函数调用</li>
      <li>匿名函数</li>
      <li>变量作用域 - 闭包</li>
      <li>其它 - 递归, 链式调用等</li>
    </ul>
  </section>
  <section class="slide">
    <h1>函数定义</h1>
    <dl>
      <dt>函数声明</dt>
      <dd><code>function getUserName( user ) {}</code></dd>
      <dt>函数表达式</dt>
      <dd><code>var getUserName = function( user ) {};</code></dd>
      <dt>基于构造函数</dt>
      <dd><code>var getUserName = new Function( 'user', 'return user.name;' );</code></dd>
    </dl>
  </section>
  <section class="slide">
    <h1>函数参数和返回值</h1>
    <h2 class="h4">参数</h2>
    <ul>
      <li>定义时, 参数可省略; 调用时, 用 arguments 访问</li>
      <li>形参[形式参数]; 参数个数 <code>getUserName.length</code></li>
      <li>实参[实际调用时参数]; 参数个数 <code>arguments.length</code></li>
      <li>调用时参数可为任意数据类型(包含 function)</li>
    </ul>
    <mark>参数传递值和引用</mark>
  </section>
  <section class="slide">
    <h1>实例</h1>
<pre class="codebox"><code contenteditable="true" class="javascript block">
function getUserName( user, boolean ) {
  alert( '实参长度: ' + arguments.length );
  user.name = 'browser';
  boolean = false;
}
alert( '形参长度: ' + getUserName.length );
// var user = {name: 'sogo' }, boolean = true;;
// getUserName( user, boolean, function() {} );
// alert( 'user: ' + JSON.stringify(user) );
// alert( 'boolean: ' + boolean );
</code>
<div class="runcase">Run</div></pre>
  </section>
  <section class="slide">
    <h1>函数参数和返回值</h1>
    <h2 class="h4">返回值</h2>
    <p>任意数据类型</p>
  </section>
  <section class="slide">
    <h1>函数调用</h1>
    <dl>
      <dt>直接调用 - 最常用</dt>
      <dd><code>getUserName( user );</code></dd>
      <dt>方法调用</dt>
      <dd><code>extension.getUserName( user );</code></dd>
      <dt>使用 call/apply</dt>
      <dd><code>getUserName.call( extension, user );</code> </dd>
      <dd><code>getUserName.apply( extensioin, [user] );</code></dd>
      <dt>使用 new 关键字 - 函数称为构造函数, 用于实例化对象</dt>
      <dd><code>new System();</code></dd>
    </dl>
  </section>
  <section class="slide">
    <h1>匿名函数</h1>
    <ul>
      <li><code>;(function() {})(); // 自执行</code></li>
      <li><code>element.addEventListener('click', function() {}, false );</code></li>
      <li><code>requestAnimationFrame(function() {}, 100); // setInterval</code></li>
      <li><code>promise().done(function() {}).fail(function() {}); // jQuery</code></li>
      <li><code>'?path=p1'.replace(/[^?&]path=[^#&]*/i,function() {});</code></li>
      <li><code>[1,3,2].sort(function( a, b ) { return a - b;});</code></li>
      <li><code>function func(){return function() {};} // return</code></li>
    </ul>
  </section>
  <section class="slide">
    <h1>变量作用域 - 闭包</h1>
    <p><strong>函数创建作用域</strong>, 作用域包裹变量.</p>
    <p><a href="https://github.com/zhanhongtao/blog/issues/6" target="_blank">讨论此话题</a></p>
<pre class="codebox"><code contenteditable="true" class="javascript block">
function createCount(){
  var count = 1;
  return function() {
    return ++count;
  };
}
var count = createCount();
count(); count(); // 3
alert( count() ); // 4;
</code><div class="runcase">Run</div></pre>
  </section>
  <section class="slide">
    <h1>实例</h1>
    <div>
<pre class="codebox">
<code class="javascript block" contenteditable="true">
// 设置字体值. 要求: 最大值为 200, 最小值为 100
var MIN_FONT_SIZE = 100;
var MAX_FONT_SIZE = 200;
function setFontSize( value ) {
  value = Math.max.call( Math, MIN_FONT_SIZE, value );
  value = Math.min.call( Math, MAX_FONT_SIZE, value );
  alert( value );
}
setFontSize( 120 );
setFontSize( 50 );
setFontSize( 240 );
</code><div class="runcase">Run</div></pre>
  </section>
  <section class="slide">
    <h1>实例</h1>
<pre class="codebox"><code contenteditable="true" class="javascript block">
// 求数据类型.
function type( s ) {
  var classtype = Object.prototype.toString.call( s );
  return classtype.slice(8, -1).toLowerCase();
}
alert( [ type(1), type('')] );
alert( [ type(void(0)), type(null), type([]), type({}) ] );
alert( [ type(new Date), type(/h/g) ] );
</code><div class="runcase">Run</div></pre>
  </section>
  <section class="slide">
    <h1>实例</h1>
<pre><code class="javascript block" contenteditable="true">
/**
  指定运行时 this.
  Function.prototype.bind
  * 修正 ie 早期版本 this 指向.
  * 函数作为回调时, 保证 this 指向.
*/
function bind( func, context ) {
  return function() {
    return func.apply( context || this, arguments );
  };
}
</code></pre>
  </section>
  <section class="slide">
    <h1>实例</h1>
<a href="./demo/bind-ie.html" target="_blank">实例(only ie)</a>
<pre><code class="javascript block" contenteditable="true">
if ( document.attachEvent ) {
  document.attachEvent( 'onclick', function() {
    alert( this );
  });
  document.attachEvent( 'onclick', se.bind(function() {
    alert( this );
  }, document);
}
</code></pre>
  </section>
  <section class="slide">
    <h1>实例</h1>
<pre class="codebox"><code class="javascript block" contenteditable="true">
var system = {
  name: 'sogou',
  runcase: function() {
    return !!this.name && this.name.indexOf( 'o' ) > -1;
  }
};
function getBrowserDataFromServer( cb ) {
  var data = { name: 'chrome' };
  return se.bind( cb, data )();
}
alert( getBrowserDataFromServer( system.runcase ) );
</code><div class="runcase">Run</div></pre>
  </section>
  <section class="slide">
    <h1>实例 - 匿名函数</h1>
<div class="sub-slide">
<pre id="anonymous-function-1" class="codebox ">
<code class="javascript block" contenteditable="true">
var element = document.getElementById( 'anonymous-function-1' );
var onClick = function() { alert('onClick'); };
element.addEventListener( 'click', onClick, false );
element.addEventListener( 'click', onClick, false );
</code><div class="runcase">Run</div></pre>
<div class="codebox sub-slide">
<pre id="anonymous-function-2">
<code class="javascript block" contenteditable="true">
var element = document.getElementById( 'anonymous-function-2' );
element.addEventListener( 'click', function() {
  alert('click');
}, false );
element.addEventListener( 'click', function() {
  alert('click');
}, false );
</code><div class="runcase">Run</div></pre>
  </section>
  <section class="slide">
    <h1>其它</h1>
    <ul>
      <li>只读 name 属性 - 返回函数名; 匿名函数返回空字符串</li>
      <li>arguments.callee 指向当前函数. 严格模式不再支持</li>
    </ul>
<pre class="codebox">
<code contenteditable="true" class="javascript block">
// 'use strict'
function getName( user ) {
  try {
    alert( arguments.callee.name );
  } catch(e) {
    alert( 'error' );
  }
}
getName();
</code><div class="runcase">Run</div></pre>
  </section>
  <section class="slide">
    <h1>其它 - 递归</h1>
    <div>
<pre data-run="1" class="codebox">
<code class="javascript block" contenteditable="true">
function flatArray( array ) {
  var i = 0, l = array.length, result = [], current;
  for ( ; i < l; i++ ) {
    current = array[i];
    // concat 支持单层合并.
    result = result.concat(se.type(current) ==='array' ?
        flatArray(current) : current );
  }
  return result;
}
alert( flatArray( [1,2,[3],[4,[5],6],7] ) );
</code><div class="runcase">Run</div></pre>
  </section>
  <section class="slide">
    <h1>其它 - 链式调用</h1>
      <div >
<pre class="codebox">
<code contenteditable="true" class="javascript block">
// 原理: 函数返回值存在方法
[1, 2].map(function( item ) {
  return item * 2;
}) // return array.
.forEach(function( item ) {
  alert( item );
});
</code><div class="runcase">Run</div></pre>
  </section>
  <section class="slide">
    <h1>其它 - 链式调用</h1>
    <div>
<pre class="codebox">
<code class="javascript block" contenteditable="true">
var _ = function( value ) {
  if ( value instanceof _ ) return value;
  if ( !(this instanceof _) ) return new _(value);
  this.core = value;
};
_.prototype.map = function( func ) {
  for ( var i = 0, l = this.core.length; i < l; i++ ) {
    this.core[i] = func.call( this, this.core[i], i, this.core);
  }
  return this;
};
_.prototype.max = function() {
  return Math.max.apply( Math, this.core );
};
_.chain = function( value ) {
  return new _( value );
};
var max = _( [1, 2, 5, 3 ] ).map(function( item ) {
  return item * 2;
}).max();
// var max = _.chain( [1, 2, 5, 3] ).max();
alert( max );
</code><div class="runcase">Run</div></pre>
  </section>
  <section class="slide">
    <h1>其它</h1>
    <ul>
      <li>函数调试 - console.trace</li>
      <li>单元测试</li>
    </ul>
  </section>
  <section class="slide slide-cover">
    <h1>function !important</h1>
  </section>
  <section class="slide">
    <h1>函数转换</h1>
    <ul>
      <li class="content-toggle-line">partial</li>
      <li>once</li>
      <li>after</li>
      <li>wrap</li>
      <li>debounce/throttle</li>
      <li>create</li>
      <li>queue/sync/syncEX</li>
    </ul>
  </section>
  <section class="content-toggle">
    <h1>partial</h1>
    <p>不完全函数 - <a href="http://benalman.com/news/2012/09/partial-application-in-javascript/" target="_blank">更多</a></p>
<pre class="codebox">
<code contenteditable="true" class="javascript block">
function partial( func ) {
  var argus = [].slice.call( arguments, 1 );
  return function() {
    return func.apply( this, argus.concat([].slice.call(arguments)) );
  };
}
var add = partial(function( a, b ) {
  return a + b;
}, 5);
alert( add(3) ); // 8
</code><div class="runcase">Run</div></pre>
  </section>
  <section class="slide">
    <h1>实用场景</h1>
    <p>用途: 防止重复绑定事件</p>
<pre class="codebox" id="demo-once">
<code contenteditable="true" class="javascript block">
var element = document.querySelector( '#demo-once' );
var bindEvents = function() {
  element.addEventListener( 'click', function() {
    alert( element.id );
  }, false );
};
// bindEvents = se.once( bindEvents );
bindEvents();
bindEvents();
</code><div class="runcase">Run</div></pre>
  </section>
  <section class="slide">
    <h1>实用场景</h1>
    <ul>
      <li>需求: 按键盘 sogou 字符, 出现惊喜.</li>
    </ul>
  </section>
  <section class="slide">
    <h1>after 实现</h1>
<pre class="codebox"><code class="javascript block" contenteditable="true">
;(function() {
    var func = (function() {
      var space = [];
      var keycodes = [ 83, 79, 71, 79, 85 ];
      var ok5;
      var timer;
      function check() {
        if ( keycodes.join() === space.join() ) {
          alert( '\u60CA\u559C' );
        }
      }
      function init() {
        space.length = 0;
        ok5 = se.after( keycodes.length, function() {
          check();
          init();
        });
      }
      function later() {
        init();
        timer = null;
      }
      init();
      return function( keycode ) {
        if ( !timer ) {
          timer = setTimeout( later, 1000 );
        }
        if ( keycodes.indexOf(keycode) === -1 ) {
          init();
          return;
        }
        space[ space.length ] = keycode;
        ok5();
      };
    })();

    document.onkeydown = function( event ) {
      event = event || window.event;
      func( event.keyCode );
    };
})();
</code><div class="runcase">Run</div></pre>
  </section>
  <section class="slide">
    <h1>状态机实现</h1>
<pre class="codebox">
<code class="javascript block" contenteditable="true">
function test( callback ) {
  var index = 0;
  var key = '83,79,71,79,85';
  var length = key.length;
  var wait = 1000;

  var timer;
  return function( code ) {
    code = '' + code;

    // 相对孤立的 timer 处理.
    if ( !timer ) {
      timer = setTimeout(function() {
        index = 0;
      }, wait);
    }
    else {
      if ( timer ) {
        clearTimeout( timer );
        timer = null;
      }
    }

    var k = key.indexOf( '' + code, index );
    if ( k === index ) {
      index += code.length + 1;
      if ( index >= length ) {
        return callback();
      }
    }
    else {
      index = 0;
    }
  };
}
var func = test(function() {
  alert( '\u60CA\u559C' );
});
document.onkeydown = function( event ) {
  event = event || window.event;
  func( event.keyCode );
};
</code><div class="runcase">Run</div></pre>
  </section>
  <section class="slide">
    <h1>实例</h1>
<pre class="codebox">
<code contenteditable="true" class="javascript block">
var array = [ 1, 2 ];
var func = (function() {
  var argus = [];
  var func = se.after( array.length, function( a, b ) {
    alert( ['result', a, b ].join('-') );
    argus.length = 0;
  });
  return function( value, index ) {
    argus[ index ] = value;
    func.apply( this, argus );
  };
})();
array.forEach(function( item, index ) {
  setTimeout(function() {
    func( item, index );
  }, (index+1) * 1000 );
});
</code><div class="runcase">Run</div></pre>
  </section>
  <section class="slide">
    <h1>应用场景</h1>
    <ul>
      <li>无侵入的统计代码</li>
      <li>功能逻辑分离</li>
      <li>函数参数处理</li>
    </ul>
  </section>
  <section class="slide">
    <h1>面向切面</h1>
<pre class="codebox"><code class="javascript block" contenteditable="true">
function sendRequest( method ) {
  alert( 'request: ' + method );
  return 1;
}
sendRequest = se.wrap( sendRequest, function( next ) {
  alert( 'before request' );
  var result = next( 'POST' );
  alert( 'after request' );
  return result;
});
sendRequest(); // 1;
</code><div class="runcase">Run</div></pre>
  </section>
  <section class="slide">
    <h1>实例</h1>
<pre class="codebox">
<code contenteditable="true" class="javascript block">
function $( selector ) {
  return document.querySelectorAll( selector );
}
$ = se.wrap( $, function(selector, next) {
  var core = next();
  return {
    each: function( func ) {
      for( var i = 0, l = core.length; i < l; i++ )
        func( core[i], i );
      return this;
    }
  };
});
$('.slide-cover').each(function(slide) {
  alert(slide.innerHTML);
});
</code><div class="runcase">Run</div></pre>
  </section>
  <section class="content-toggle">
    <h1>wrap - 模拟once</h1>
<pre class="codebox"><code contenteditable="true" class="javascript block">
var a = function() {
  alert(1);
};

a = se.wrap( a, function a( next ) {
  if ( a.tag ) return a.cache;
  a.tag = true;
  return a.cache = next();
});

a();
a();
</code><div class="runcase">Run</div></pre>
  </section>
  <section class="slide">
    <h1>实用场景</h1>
    <ul>
      <li>频繁点击按钮, 提交表单</li>
      <li>blur和submit 重复提交操作</li>
      <li>频繁按 ctrl + s 快捷键</li>
      <li>resize 频繁重新渲染 DOM</li>
      <li>mousemove/scroll 频繁触发</li>
      <li>网页中搜索建议, 发送的请求如何处理?</li>
    </ul>
  </section>
  <section class="slide">
    <h1>懒惰型函数</h1>
    <p>短时间内(100ms)多次发生相同事件, 但仅需要执行最后一次.</p>
  </section>
  <section class="slide">
    <h1>节制性函数</h1>
    <p>短时间内(100ms)发生n次相同事件, 而仅需执行m(m<=n)次.</p>
  </section>
  <section class="slide">
    <h1>实用场景</h1>
    <ul>
      <li title="Authentic（真实）、Energetic（动感）、Reflective（具反射性）及Open（开阔）">window7/8 Aero 效果</li>
      <li>sogou图片搜索, 图片放大效果. (<a href="http://pic.sogou.com/pics?query=sogou&p=&dp=&di=2&_asf=pic.sogou.com&_ast=1379479771&w=05009900" target="_blank">实例</a>)</li>
      <li>hover 切换标签(<a href="http://tv.sohu.com/" target="_blank" title="电视局排行榜">实例</a>)</li>
    </ul>
  </section>
  <section class="slide">
    <h1>实例</h1>
<div style="position:relative">
<pre class="codebox"><code id="demo-create" contenteditable="true" class="javascript block">
var element = document.querySelector( '.demo-case-fixed' );
var slide = document.querySelector( '#demo-create' );
var f = se.create( function() {
  element.style.display = 'block';
}, true, 0);
var fd = se.create(function() {
  f.off(function() {
    element.style.display = 'none';
  });
}, true, 0);

var onMouseOver = (function() {
  var timer;
  return function () {
    if ( timer ) {
      clearTimeout( timer );
    }
    fd.off();
    f.on();
    timer = setTimeout( f.done, 200 );
  };
})();
var onMouseOut = (function( e ) {
  var timer;
  return function() {
    if ( timer ) clearTimeout( timer );
    fd.on();
    timer = setTimeout(function() {
      fd.done();
    }, 10);
  };
})();
slide.addEventListener( 'mouseenter', onMouseOver, false );
slide.addEventListener( 'mouseleave', onMouseOut, false );
element.addEventListener( 'mouseenter', onMouseOver, false );
element.addEventListener( 'mouseleave', onMouseOut, false );
</code><div class="runcase">Run</div></pre>
  <div class="demo-case-fixed"></div>
  <style>
    .demo-case-fixed {
      display: none;
      position: absolute;
      top: 0;
      left: 0;
      width: 50px;
      height: 50px;
      background-color: red;
    }
  </style>
</div>
  </section>
  <section class="slide">
    <h1>实用场景</h1>
    <ul>
      <li>元素a, 从位置[0,0] 先移到[0, 100], 再到[100, 100] <a href="../html/queue.html" target="_blank">实例</a></li>
      <li>需求: 对 n 个服务接口, 做单元测试.</li>
      <li>nodejs 中多表依赖查询</li>
    </ul>
  </section>
  <section class="slide">
    <h1>queue</h1>
<pre class="codebox"><code class="javascript block" contenteditable="true">
console.time( 'queue' );
se.queue( [1, 2], function( item, index, ret, next ) {
  setTimeout(function() {
    next( item );
  }, (index+1) * 1000 );
}, function( a, b ) {
  console.timeEnd( 'queue' );
  alert( [ 'result', a, b ].join('-') );
});
</code><div class="runcase">Run</div></pre>
  </section>
  <section class="slide">
    <h1>实用场景</h1>
    <ul>
      <li>同时请求模板和数据, 成功后渲染页面</li>
      <li><a href="../html/sync.html" target="_blank">动画实例</a></li>
    </ul>
  </section>
  <section class="slide">
    <h1>sync</h1>
<pre class="codebox">
<code contenteditable="true" class="javascript block">
console.time( 'sync' );
se.sync( [1, 2], function( item, index, ret, done ) {
  setTimeout( function() {
    done( item );
  }, (index+1) * 1000 );
}, function( a, b ) {
  console.timeEnd( 'sync' );
  alert( [ 'result', a, b ].join('-') );
});
</code><div class="runcase">Run</div></pre>
  </section>
  <section class="slide">
    <h1>sync 增强版</h1>
<pre class="codebox">
<code contenteditable="true" class="javascript block">
se.sync( [1, 2, 3, 4, 5], function( item, done ) {
  setTimeout(function() {
    done( item );
  }, Math.random() * 1000 );
}, function() {
  var argus = [].slice.call( arguments );
  alert( argus );
}, true);
</code><div class="runcase">Run</div></pre>
  </section>
  <section class="slide">
    <h1>参考</h1>
    <ul>
      <li>权威指南 6</li>
      <li><a href="http://sketch.evanyou.me/async_asap.html" target="_blank">前端异步 api 调用</a></li>
      <li><a href="http://www.zhihu.com/question/19805411" target="_blank">如何防止重复提交?</a></li>
      <li><a href="http://lodash.com/" target="_blank">lodash</a> & <a href="https://github.com/jashkenas/underscore/blob/master/underscore.js" target="_blank">underscore.js</a></li>
      <li><a href="http://caolanmcmahon.com/posts/flexible_callback_arguments/" target="_blank">flexible callback arguments</a></li>
      <li><a href="http://osteele.com/sources/javascript/functional/" target="_blank">functional</a></li>
    </ul>
  </section>
  <section class="slide slide-cover">
    <h1>?</h1>
  </section>
  <nav id="navigator"></nav>
  <script src="./js/event.js"></script>
  <script src="../scripts/se.js?v=1"></script>
  <script src="./js/hash.js"></script>
  <script src="./js/runcase.js?v=1"></script>
  <script src="./js/pattern.js"></script>
  <script src="./js/ui.js"></script>
  <script src="./js/resize.js"></script>
  <script src="./js/app.js"></script>
  <script src="./js/touch.js"></script>
  <script src="./js/auto.slide.js"></script>
</body>
</html>