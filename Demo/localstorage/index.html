<!DOCTYPE HTML>
<html lang="en-US">
<head>
	<meta charset="UTF-8">
	<title>storage</title>
</head>
<body>
	<form action="" id="ef">
		<p>
			<label for="name">Name:<input type="text" id="name" name="name" placeholder="Input your name!"></label>
		</p>
		<p>
			<label for="password">Password:<input type="password" name="password" placeholder="Input your password!"></label>
		</p>
		<input type="submit">
		<button formnovalidate id="save">Save</button>
		<button formnovalidate id="clear">Clear old data</button>
	</form>
	<script type="text/javascript">
		var ef = document.getElementById('ef');
		var saveBtn = document.getElementById('save');
		var clearBtn = document.getElementById('clear');


		window.addEventListener('storage', function () {
			console.log(arguments);
		}, false);


		function clear() {
			try {
				localStorage.clear();
			}
			catch (e) {
				console.log(e);
			}
		}

		function save(key, value) {
			if (key) {
				try {
					// localStorage[key] = value;
					localStorage.setItem(key, value);
				}
				catch (e) {
					console.log(e);
				}
			}
		}

		function getValue(key) {
			var ret;
			if (key) {
				try {
					ret = localStorage.getItem(key);
				}
				catch (e) {
					console.log(e);
				}
			}
			return ret;
		}

		function update(key) {
			if (key === 'clear') {
				readHTML(function (name, value, item) {
					clear();
					item.value = '';
				})
			}
			else {
				readHTML(function (name, value, item) {
					save(name, value);
				});
			}
		}

		function init() {
			readHTML(function (name, value, item) {
				var _value = getValue(name);
				value = _value == null ? value : _value;
				item.value = value == null ? '' : value;
			});
		}

		function readHTML(callback) {
			if (!callback) return;
			var inputs = ef.getElementsByTagName('input');
			var item;
			var name;
			var value;
			for (var i = 0, l = inputs.length; i < l; i++) {
				item = inputs[i];
				if (item.type == 'submit') {
					continue;
				}
				name = item.name;
				value = item.value;
				callback(name, value, item);
			}
		}

		init();
		saveBtn.onclick = function () {
			update();
			return false;
		};

		clearBtn.onclick = function () {
			update('clear');
			return false;
		};


	</script>
</body>
</html>